<!DOCTYPE html>
<head>
	<% include ./templates/head.ejs %>
	<style>
		<% include ./style/workpage.css %>
	</style>
</head>
<body>
	<header>
        <% include ./templates/header.ejs %>
    </header>
	<div class="contentBox maxWrapper">
        <div class="content">
			<article>
				<div id="workhead">
					<h1><%= work.name %></h1>
					<span id="buttons">
						<button class="dislike" id="<%=work.id%>" dislikes=<%=numDislikes%>>싫어요 <span class='hh'><%= numDislikes %></span></button>
						<button class="joins" id="<%=work.id%>">참여</button>
					</span>
					<h2><%= work.desc %></h2>
				</div>
				<section id='readme' class='md'>
					<h3>README.md</h3>
					<%- include('../../public/workpage/'+work.name+'/front.html') %>
				</section>
				<div>
					<!--group participants-->
				</div>
				<section id='needs' class='md'>
					<h3>이런 사람 와라</h3>
					<%- include('../../public/workpage/'+work.name+'/needs.html') %>
				</section>
				<section>
					<h3>로그오브공작</h3>
					<!--여기에 소켓으로 로그 긁어와서 보여주기-->
					<form action="/work/<%=work.name%>" method="post">
						<input type="submit" value="똥싸기">
					</form>
				</section>
			</article>
		</div>
	</div>
	<footer>
        <% include ./templates/footer.ejs %>
    </footer>
	<script>
		var socket = io.connect('http://<%=host%><%=port%>');
		var disliked = false;
		$('.dislike').click(function(){
			console.log("dislike emitted");
			var id = $(this).attr('id');
			socket.emit('clientUpdateDislike', {
				workId: <%=work.id%>,
				<% if(user) { %>
				userId: <%=user.id%>
				<% } else { %>
				user: null
				<% } %>
			});
		});
		$('.joins').click(function(){
			console.log("joins emitted");
			var id = $(this).attr('id');
			socket.emit('clientUpdateJoin',{
				workId: <%=work.id%>,
				<% if(user) { %>
				userId: <%=user.id%>
				<% } else { %>
				user: null
				<% } %>
			});
		});
		
		socket.on('serverUpdate',function(data){
			
		});
	</script>
</body>
</html>